var iCurrent=null;var oCurrent=null;var oldValue="";var g_ajax_obj=null;function mkSearchAddField(field){var oField=document.getElementById(field);if(oField){oField.onkeydown=function(e){if(!e)e=window.event;return mkSearchKeyDown(e,oField);};oField.onkeyup=function(e){if(!e)e=window.event;return mkSearchKeyUp(e,oField);};oField.onclick=function(e){mkSearchClose();return true;};oField.ondblclick=function(e){mkSearchToggle(oField);};}}mkSearchAddField("mk_side_search_field");function mkSearchKeyUp(e,oField){var keyCode=e.which||e.keyCode;switch(keyCode){case 13:case 27:mkSearchClose();e.returnValue=false;e.cancelBubble=true;break;default:if(oField.value==""){e.returnValue=false;e.cancelBubble=true;mkSearchClose();}else mkSearch(oField);break;}}function mkSearchButton(){var oField=document.getElementById("mk_side_search_field");var ev={"which":0,"keyCode":13};return mkSearchKeyDown(ev,oField);}function search_dropdown_value(){if(oCurrent)return oCurrent.id.replace('result_','');else return null;}function mkSearchKeyDown(e,oField){var keyCode=e.which||e.keyCode;switch(keyCode){case 13:if(oCurrent!=null){mkSearchNavigate();oField.value=search_dropdown_value();mkSearchClose();}else{if(oField.value=="")return;top.frames.main.location.href='search_open.py?q='+encodeURIComponent(oField.value);mkTermSearch();mkSearchClose();}e.returnValue=false;e.cancelBubble=true;break;case 27:mkSearchClose();e.returnValue=false;e.cancelBubble=true;break;case 9:if(mkSearchResultShown())mkSearchClose();return;break;case 38:case 40:if(!mkSearchResultShown())mkSearch(oField);mkSearchMoveElement(keyCode==38?-1:1);e.preventDefault();return false;break;}oldValue=oField.value;}function mkSearchNavigate(){top.frames.main.location.href=oCurrent.href;}function mkSearchMoveElement(step){if(iCurrent==null)iCurrent=-1;iCurrent+=step;var oResults=document.getElementById('mk_search_results');if(!oResults)return;if(iCurrent<0)iCurrent=oResults.children.length-1;if(iCurrent>oResults.children.length-1)iCurrent=0;oResults=oResults.childNodes;var a=0;for(var i=0;i<oResults.length;i++)if(oResults[i].tagName=='A'){if(a==iCurrent){oCurrent=oResults[i];oResults[i].setAttribute('class','active');}else oResults[i].setAttribute('class','inactive');a++;}}function mkSearchResultShown(){return document.getElementById('mk_search_results')?true:false;}function mkSearchToggle(oField){if(mkSearchResultShown())mkSearchClose();else mkSearch(oField);}function mkSearchClose(){var oContainer=document.getElementById('mk_search_results');if(oContainer)oContainer.parentNode.removeChild(oContainer);iCurrent=null;oCurrent=null;}function handle_search_response(oField,code){if(code!=''){var oContainer=document.getElementById('mk_search_results');if(!oContainer){var oContainer=document.createElement('div');oContainer.setAttribute('id','mk_search_results');oField.parentNode.appendChild(oContainer);}oContainer.innerHTML=code;}else mkSearchClose();}function mkTermSearch(){if(g_ajax_obj){g_ajax_obj.abort();g_ajax_obj=null;}}function mkSearch(oField){if(oField==null)return;var val=oField.value;if(mkSearchResultShown()&&val==oldValue)return;oldValue=val;mkTermSearch();g_ajax_obj=get_url('ajax_search.py?q='+encodeURIComponent(val),handle_search_response,oField);}