var g_content_loc=null;var g_sidebar_folded=false;if(window.addEventListener){window.addEventListener("mousemove",function(e){snapinDrag(e);dragScroll(e);return false;},false);window.addEventListener("mousedown",startDragScroll,false);window.addEventListener("mouseup",stopDragScroll,false);if(weAreFirefox)window.addEventListener('DOMMouseScroll',scrollWheel,false);else window.addEventListener('mousewheel',scrollWheel,false);}else{document.documentElement.onmousemove=function(e){snapinDrag(e);dragScroll(e);return false;};document.documentElement.onmousedown=startDragScroll;document.documentElement.onmouseup=stopDragScroll;document.documentElement.onmousewheel=scrollWheel;}function registerEdgeListeners(obj){var edges;if(!obj)edges=[parent.frames[1],document.getElementById('side_header'),document.getElementById('side_footer')];else edges=[obj];for(var i=0;i<edges.length;i++){if(!contentFrameAccessible())continue;if(window.addEventListener)edges[i].addEventListener("mousemove",on_mouse_leave,false);else edges[i].onmousemove=on_mouse_leave;}}function on_mouse_leave(e){if(typeof mkSearchClose!="undefined")mkSearchClose();return stop_snapin_dragging(e);}function stop_snapin_dragging(e){stopDragScroll(e);snapinTerminateDrag(e);return false;}var snapinDragging=false;var snapinOffset=[0,0];var snapinStartPos=[0,0];var snapinScrollTop=0;function snapinStartDrag(event){if(!event)event=window.event;var target=getTarget(event);var button=getButton(event);if(snapinDragging!==false||button!='LEFT'||target.tagName!='DIV')return true;if(event.stopPropagation)event.stopPropagation();event.cancelBubble=true;snapinDragging=target.parentNode;snapinOffset=[event.clientY-target.parentNode.offsetTop,event.clientX-target.parentNode.offsetLeft];snapinStartPos=[event.clientY,event.clientX];snapinScrollTop=document.getElementById('side_content').scrollTop;if(event.preventDefault)event.preventDefault();else event.returnValue=false;return false;}function snapinDrag(event){if(!event)event=window.event;if(snapinDragging===false)return true;snapinDragging.style.position='absolute';var newTop=event.clientY-snapinOffset[0]-snapinScrollTop;newTop+=document.getElementById('side_content').scrollTop;snapinDragging.style.top=newTop+'px';snapinDragging.style.left=(event.clientX-snapinOffset[1])+'px';snapinDragging.style.zIndex=200;removeSnapinDragIndicator();var line=document.createElement('div');line.setAttribute('id','snapinDragIndicator');var o=getSnapinTargetPos();if(o!=null)snapinAddBefore(o.parentNode,o,line);else snapinAddBefore(snapinDragging.parentNode,null,line);return true;}function snapinAddBefore(par,o,add){if(o!=null)par.insertBefore(add,o);else par.appendChild(add);}function removeSnapinDragIndicator(){var o=document.getElementById('snapinDragIndicator');if(o)o.parentNode.removeChild(o);}function snapinDrop(event,targetpos){if(snapinDragging==false)return true;snapinDragging.style.top='';snapinDragging.style.left='';snapinDragging.style.position='';if(snapinStartPos[0]==event.clientY&&snapinStartPos[1]==event.clientX){if(event.preventDefault)event.preventDefault();if(event.stopPropagation)event.stopPropagation();event.returnValue=false;return false;}var par=snapinDragging.parentNode;par.removeChild(snapinDragging);snapinAddBefore(par,targetpos,snapinDragging);var thisId=snapinDragging.id.replace('snapin_container_','');var before='';if(targetpos!=null)before='&before='+targetpos.id.replace('snapin_container_','');get_url('sidebar_move_snapin.py?name='+thisId+before);}function snapinTerminateDrag(){if(snapinDragging==false)return true;removeSnapinDragIndicator();snapinDragging.style.top='';snapinDragging.style.left='';snapinDragging.style.position='';snapinDragging=false;}function snapinStopDrag(event){if(!event)event=window.event;removeSnapinDragIndicator();snapinDrop(event,getSnapinTargetPos());snapinDragging=false;}function getDivChildNodes(node){var children=[];var childNodes=node.childNodes;for(var i=0;i<childNodes.length;i++)if(childNodes[i].tagName==='DIV')children.push(childNodes[i]);return children;}function getSnapinList(){if(snapinDragging===false)return true;var l=[];var childs=getDivChildNodes(snapinDragging.parentNode);for(var i=0;i<childs.length;i++){var child=childs[i];if(child.id&&child.id.substr(0,7)=='snapin_'&&child.id!=snapinDragging.id)l.push(child);}return l;}function getSnapinCoords(obj){var snapinTop=snapinDragging.offsetTop;var bottomOffset=obj.offsetTop+obj.clientHeight-snapinTop;if(bottomOffset<0)bottomOffset=-bottomOffset;var topOffset=obj.offsetTop-snapinTop;if(topOffset<0)topOffset=-topOffset;var offset=topOffset;var corner=0;if(bottomOffset<topOffset){offset=bottomOffset;corner=1;}return [bottomOffset,topOffset,offset,corner];}function getSnapinTargetPos(){var snapinTop=snapinDragging.offsetTop;var childs=getSnapinList();var objId=-1;var objCorner=-1;for(var i=0;i<childs.length;i++){var child=childs[i];if(!child.id||child.id.substr(0,7)!='snapin_'||child.id==snapinDragging.id)continue;if(objId===-1){objId=i;var coords=getSnapinCoords(child);objCorner=coords[3];continue;}var curCoords=getSnapinCoords(childs[objId]);var newCoords=getSnapinCoords(child);if(newCoords[2]<curCoords[2]){objCorner=newCoords[3];objId=i;}}if(objId==0&&objCorner==0)return childs[0];else return childs[(parseInt(objId)+1)];}function contentFrameAccessible(){try{var d=parent.frames[1].document;return true;}catch(e){return false;}}function update_content_location(){if(typeof (window.parent.orig_title)=='undefined')window.parent.orig_title=window.parent.document.title;var content_frame=window.parent.frames[1];if(content_frame.document.title!='')var page_title=window.parent.orig_title+' - '+content_frame.document.title;else var page_title=window.parent.orig_title;window.parent.document.title=page_title;var parts=window.parent.location.pathname.split('/');parts.pop();var cmk_path=parts.join('/');var rel_url=content_frame.location.pathname+content_frame.location.search+content_frame.location.hash;var index_url=cmk_path+'/index.py?start_url='+encodeURIComponent(rel_url);if(window.parent.history.replaceState){if(rel_url&&rel_url!='blank'){window.parent.history.replaceState({},page_title,index_url);g_content_loc=parent.frames[1].document.location.href;}}else g_content_loc=parent.frames[1].document.location.href;}function debug(s){window.parent.frames[1].document.write(s+'<br />');}function set_sidebar_size(){var oHeader=document.getElementById('side_header');var oContent=document.getElementById('side_content');var oFooter=document.getElementById('side_footer');var height=pageHeight();if(height==0)return;oContent.style.height=(height-oHeader.clientHeight-oFooter.clientHeight-2)+'px';}var scrolling=true;function scrollwindow(speed){var c=document.getElementById('side_content');if(scrolling){c.scrollTop+=speed;setTimeout("scrollwindow("+speed+")",10);}}var dragging=false;var startY=0;var startScroll=0;function startDragScroll(event){if(!event)event=window.event;var target=getTarget(event);var button=getButton(event);if(button!='LEFT')return true;if(g_sidebar_folded){unfold_sidebar();return prevent_default_events(event);}else if(!g_sidebar_folded&&event.clientX<10&&target.tagName!="OPTION"){fold_sidebar();return prevent_default_events(event);}if(dragging===false&&target.tagName!='A'&&target.tagName!='INPUT'&&target.tagName!='SELECT'&&target.tagName!='OPTION'&&!(target.tagName=='DIV'&&target.className=='heading')){dragging=event;startY=event.clientY;startScroll=document.getElementById('side_content').scrollTop;return prevent_default_events(event);}return true;}function stopDragScroll(event){dragging=false;}function dragScroll(event){if(!event)event=window.event;if(dragging===false)return true;if(event.preventDefault)event.preventDefault();event.returnValue=false;if(event.stopPropagation)event.stopPropagation();event.cancelBubble=true;var inhalt=document.getElementById('side_content');var diff=startY-event.clientY;inhalt.scrollTop+=diff;if(weAreOpera)storeScrollPos();startY=event.clientY;dragging=event;return false;}function sidebar_width(){if(g_sidebar_folded)return 10;else return 280;}function fold_sidebar(){g_sidebar_folded=true;document.getElementById('check_mk_sidebar').style.position="relative";document.getElementById('check_mk_sidebar').style.left="-265px";document.getElementById('side_footer').style.display="none";document.getElementById('side_version').style.display="none";parent.document.body.cols=sidebar_width()+",*";get_url('sidebar_fold.py?fold=yes');}function unfold_sidebar(){g_sidebar_folded=false;document.getElementById('check_mk_sidebar').style.position="";document.getElementById('check_mk_sidebar').style.left="0";document.getElementById('side_footer').style.display="";document.getElementById('side_version').style.display="";parent.document.body.cols=sidebar_width()+",*";get_url('sidebar_fold.py?fold=');}function handle(delta){if(delta<0){scrolling=true;scrollwindow(-delta*20);scrolling=false;}else{scrolling=true;scrollwindow(-delta*20);scrolling=false;}}function scrollWheel(event){var delta=0;if(!event)event=window.event;if(event.wheelDelta)delta=event.wheelDelta/120;else if(event.detail)delta=-event.detail/3;if(delta)handle(delta);if(weAreOpera)storeScrollPos();if(event.preventDefault)event.preventDefault();else event.returnValue=false;return false;}refresh_snapins=null;restart_snapins=null;sidebar_restart_time=null;sidebar_update_interval=null;function remove_sidebar_snapin(oLink,url){var container=oLink.parentNode.parentNode.parentNode;var id=container.id.replace("snapin_container_","");call_ajax(url,{handler_data:"snapin_"+id,response_handler:function(id,_unused){remove_snapin(id);},method:"GET"});}function remove_snapin(id){var container=document.getElementById(id).parentNode;var myparent=container.parentNode;myparent.removeChild(container);for(var i in refresh_snapins){var name=refresh_snapins[i][0];if(id=="snapin_"+name){refresh_snapins.splice(i,1);break;}}if(parent.frames[1]){var href=encodeURIComponent(parent.frames[1].location);if(href.indexOf("sidebar_add_snapin.py")>-1)parent.frames[1].location.reload();}}function toggle_sidebar_snapin(oH2,url){var childs;if(oH2.tagName=="A")childs=oH2.parentNode.parentNode.parentNode.childNodes;else childs=oH2.parentNode.parentNode.childNodes;for(var i in childs){child=childs[i];if(child.tagName=='DIV'&&child.className=='content')var oContent=child;else if(child.tagName=='DIV'&&(child.className=='head open'||child.className=="head closed"))var oHead=child;}var oImgMini=oHead.childNodes[0].childNodes[0].childNodes[0];var closed=oContent.style.display=="none";if(closed){oContent.style.display="block";oHead.className="head open";oImgMini.src="images/button_minisnapin.png";}else{oContent.style.display="none";oHead.className="head closed";oImgMini.src="images/button_maxisnapin.png";}get_url(url+(closed?"open":"closed"));}function reload_main_plus_sidebar(id,code){parent.frames[1].location.reload();parent.frames[0].location.reload();}function switch_customer(customer_id,switch_state){get_url("switch_customer.py?_customer_switch="+customer_id+":"+switch_state,reload_main_plus_sidebar,null);}function switch_site(switchvar){get_url("switch_site.py?"+switchvar,reload_main_plus_sidebar,null);}var g_seconds_to_update=null;function refresh_single_snapin(name){var url='sidebar_snapin.py?names='+name;var ids=['snapin_'+name];get_url(url,bulkUpdateContents,ids);}function sidebar_scheduler(){if(g_seconds_to_update==null)g_seconds_to_update=sidebar_update_interval;else g_seconds_to_update-=1;var newcontent="";var to_be_updated=[];for(var i=0;i<refresh_snapins.length;i++){var name=refresh_snapins[i][0];if(refresh_snapins[i][1]!=''){var url=refresh_snapins[i][1];if(g_seconds_to_update<=0)get_url(url,updateContents,"snapin_"+name);}else to_be_updated.push(name);}if(to_be_updated.length>0)if(g_seconds_to_update<=0){var url='sidebar_snapin.py?names='+to_be_updated.join(',');if(sidebar_restart_time!==null)url+='&since='+sidebar_restart_time;var ids=[];for(var i=0,len=to_be_updated.length;i<len;i++)ids.push('snapin_'+to_be_updated[i]);get_url(url,bulkUpdateContents,ids);}if(g_sidebar_notify_interval!==null){var timestamp=Date.parse(new Date())/1000;if(timestamp%g_sidebar_notify_interval==0)update_messages();}if(contentFrameAccessible()&&g_content_loc!=parent.frames[1].document.location.href){registerEdgeListeners(parent.frames[1]);update_content_location();}if(g_seconds_to_update<=0)g_seconds_to_update=sidebar_update_interval;setTimeout(function(){sidebar_scheduler();},1000);}function setCookie(cookieName,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=cookieName+"="+encodeURIComponent(value)+((expiredays==null)?"":";expires="+exdate.toUTCString());}function getCookie(cookieName){if(document.cookie.length==0)return null;var cookieStart=document.cookie.indexOf(cookieName+"=");if(cookieStart==-1)return null;cookieStart=cookieStart+cookieName.length+1;var cookieEnd=document.cookie.indexOf(";",cookieStart);if(cookieEnd==-1)cookieEnd=document.cookie.length;return decodeURIComponent(document.cookie.substring(cookieStart,cookieEnd));}function initScrollPos(){var scrollPos=getCookie('sidebarScrollPos');if(!scrollPos)scrollPos=0;document.getElementById('side_content').scrollTop=scrollPos;}function storeScrollPos(){setCookie('sidebarScrollPos',document.getElementById('side_content').scrollTop,null);}g_last_view='dashboard.py?name=main';g_last_folder='';function highlight_link(link_obj,container_id){var this_snapin=document.getElementById(container_id);if(container_id=='snapin_container_wato_folders')var other_snapin=document.getElementById('snapin_container_views');else var other_snapin=document.getElementById('snapin_container_wato_folders');if(this_snapin&&other_snapin){if(this_snapin.getElementsByClassName)var links=this_snapin.getElementsByClassName('link');else var links=document.getElementsByClassName('link',this_snapin);for(var i=0;i<links.length;i++)links[i].style.fontWeight='normal';link_obj.style.fontWeight='bold';}}function wato_folders_clicked(link_obj,folderpath){g_last_folder=folderpath;highlight_link(link_obj,'snapin_container_wato_folders');parent.frames[1].location=g_last_view+'&wato_folder='+encodeURIComponent(g_last_folder);}function wato_views_clicked(link_obj){g_last_view=link_obj.href;highlight_link(link_obj,'snapin_container_views');highlight_link(link_obj,'snapin_container_dashboards');if(g_last_folder!=''){parent.frames[1].location=g_last_view+'&wato_folder='+encodeURIComponent(g_last_folder);return false;}else return true;}function wato_tree_click(link_obj,folderpath){var topic=document.getElementById('topic').value;var target=document.getElementById('target_'+topic).value;if(target.substr(0,9)=='dashboard'){dashboard_name=target.substr(10,target.length);href='dashboard.py?name='+encodeURIComponent(dashboard_name);}else href='view.py?view_name='+encodeURIComponent(target);href+='&wato_folder='+encodeURIComponent(folderpath);parent.frames[1].location=href;}function wato_tree_topic_changed(topic_field){var topic=topic_field.value;var select_fields=document.getElementsByTagName('select');for(var i=0;i<select_fields.length;i++)if(select_fields[i].id&&select_fields[i].id.substr(0,7)=='target_'){select_fields[i].selected='';if(select_fields[i].id=='target_'+topic)select_fields[i].style.display='inline';else select_fields[i].style.display='none';}get_url('ajax_set_foldertree.py?topic='+encodeURIComponent(topic)+'&target=');}function wato_tree_target_changed(target_field){var topic=target_field.id.substr(7,target_field.id.length);var target=target_field.value;get_url('ajax_set_foldertree.py?topic='+encodeURIComponent(topic)+'&target='+encodeURIComponent(target));}function add_html_var(url,varname,value){var re=new RegExp('&'+varname+'=[^&]*');var new_url=url.replace(re,"");if(new_url.indexOf('?')!='-1')new_url+="&"+varname+"="+encodeURIComponent(value);else new_url+="?"+varname+"="+encodeURIComponent(value);return new_url;}function set_snapin_site(event,ident,select_field){if(!event)event=window.event;get_url('sidebar_ajax_set_snapin_site.py?ident='+encodeURIComponent(ident)+'&site='+encodeURIComponent(select_field.value));location.reload();return prevent_default_events(event);}var g_sidebar_notify_interval;function init_messages(interval){g_sidebar_notify_interval=interval;update_message_trigger();}function handle_update_messages(_unused,code){var c=document.getElementById('messages');if(c){c.innerHTML=code;executeJSbyObject(c);update_message_trigger();}}function update_messages(){var c=document.getElementById('messages');if(c)c.innerHTML='';get_url('sidebar_get_messages.py',handle_update_messages);}function get_hint_messages(c){var hints;if(c.getElementsByClassName)hints=c.getElementsByClassName('popup_msg');else hints=document.getElementsByClassName('popup_msg',c);return hints;}function update_message_trigger(){var c=document.getElementById('messages');if(c){var b=document.getElementById('msg_button');var hints=get_hint_messages(c);if(hints.length>0){b.style.display='inline';var l=document.getElementById('msg_label');if(!l){var l=document.createElement('span');l.setAttribute('id','msg_label');b.appendChild(l);}l.innerHTML=''+hints.length;}else b.style.display='none';}}function mark_message_read(msg_id){get_url('sidebar_message_read.py?id='+msg_id);update_message_trigger();}function read_message(){var c=document.getElementById('messages');if(!c)return;var hints=get_hint_messages(c);var msg=hints[0];c.removeChild(msg);c.parentNode.appendChild(msg);var msg_id=msg.id.replace('message-','');mark_message_read(msg_id);}function message_close(msg_id){var m=document.getElementById('message-'+msg_id);if(m)m.parentNode.removeChild(m);}